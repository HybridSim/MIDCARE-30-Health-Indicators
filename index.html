<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MIDCARE© Determinants of Health Dashboard – MID-West (MW) — 6 Categories × 5 Sub‑sliders (Top Row + Compact)</title>
<style>
  :root {
    --bg: #ffffff;
    --card: #f8fafc;
    --ink: #111111;
    --muted: #555555;
    --accent-navy: #1e3a8a;
    --accent-teal: #0d9488;
    --border: #e5e7eb;
    --radius: 10px;
  }
  html, body {
    background: var(--bg);
    color: var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    margin: 0; padding: 0;
    overflow-x: hidden;
  }
  .container { max-width: 1320px; margin: 14px auto; padding: 0 10px 36px; }

  .title-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .title-logo { height: 34px; width: auto; }
  h1 { font-size: 20px; margin: 4px 0; color: var(--accent-navy); }
  .subtle { color: var(--muted); font-size: 12px; margin-bottom: 8px; }

  .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 10px; box-shadow: 0 3px 10px rgba(0,0,0,.05); }

  .controls { display: flex; flex-wrap: wrap; gap: 8px; margin: 8px 0 10px; }
  .btn { background: var(--accent-navy); color: #fff; border: 1px solid var(--accent-navy); padding: 6px 10px; border-radius: 999px; cursor: pointer; font-weight: 700; font-size: 12px; }
  .btn.alt { background: var(--accent-teal); border-color: var(--accent-teal); }
  .btn:hover { filter: brightness(.96); }

  /* --- Category grid: 6 across on desktop --- */
  .cat-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 6px;
  }
  @media (max-width: 1180px) { .cat-grid { grid-template-columns: repeat(3, 1fr); } }
  @media (max-width: 780px) { .cat-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 520px) { .cat-grid { grid-template-columns: 1fr; } }

  .cat-card {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 6px;
  }
  .cat-title {
    font-weight: 900;
    color: var(--accent-navy);
    font-size: 11px;
    margin-bottom: 4px;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Compact sub-rows: label above slider; tighter spacing */
  .sub-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2px;
    padding: 2px 4px;
    margin-bottom: 3px;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: #f9fafb;
  }
  .lbl { font-size: 9.5px; font-weight: 600; color: var(--ink); line-height: 1.2; }
  .unit { font-size: 8.5px; color: var(--muted); }
  input[type=range] { width: 100%; height: 14px; -webkit-appearance: none; background: transparent; }
  input[type=range]::-webkit-slider-runnable-track { height: 4px; border-radius: 999px; background: linear-gradient(90deg, var(--accent-navy), var(--accent-teal)); }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; margin-top: -4px; width: 10px; height: 10px; border-radius: 50%; background: white; border: 2px solid var(--accent-teal); }
  input[type=range]::-moz-range-track { height: 4px; border-radius: 999px; background: linear-gradient(90deg, var(--accent-navy), var(--accent-teal)); }
  input[type=range]::-moz-range-thumb { width: 10px; height: 10px; border-radius: 50%; background: white; border: 2px solid var(--accent-teal); }
  .val { text-align: right; font-variant-numeric: tabular-nums; font-weight: 700; color: var(--accent-navy); font-size: 9.5px; }
  .ref { text-align: right; color: var(--muted); font-size: 9px; margin-top: -2px; }

  /* Chart area */
  .viz { margin-top: 12px; }
  .chart-top { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; }
  select { background: #fff; border: 1px solid #d1d5db; border-radius: 8px; padding: 4px 6px; font-size: 12px; }
  .chart-wrap { height: 280px; } /* reduced height to fit one screen */
  .axis-caption { color: var(--muted); font-size: 11px; margin-top: 4px; }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
</head>
<body>
  <div class="container">
    <div class="title-row">
      <img src="https://assets.zyrosite.com/AoP61N2BR4i8Q6jl/logo-hsml-AE07eKDgMLFgWBoQ.png" alt="HSML Logo" class="title-logo">
      <h1>MIDCARE© Determinants of Health Dashboard – MID-West (MW)</h1>
    </div>
    <p class="subtle">
      Use the sliders in each category box to adjust the five indicators for that category. The chart below updates instantly
      to reflect the changes, comparing the adjusted RHA E&nbsp;MW values against the national baseline. The reset buttons
      restore either the original RHA defaults or the national averages.
    </p>

    <div class="controls">
      <button class="btn" id="resetRHA">Reset to RHA E MW defaults</button>
      <button class="btn alt" id="resetNat">Reset to National averages</button>
    </div>

    <!-- Six compact category cards across the top -->
    <div id="catGrid" class="cat-grid"></div>

    <!-- Chart below -->
    <div id="viz" class="card viz">
      <div class="chart-top">
        <div>Category chart:</div>
        <label>Category <select id="catSelect"></select></label>
        <label>Scale <select id="scaleSelect">
          <option value="raw">Raw values</option>
          <option value="pctNat">% of National avg</option>
          <option value="diff">Difference (RHA − Nat)</option>
        </select></label>
      </div>
      <div class="chart-wrap">
        <canvas id="catChart"></canvas>
      </div>
      <div class="axis-caption">X axis: Value (varies by mode). Y axis: Indicators within the selected category.</div>
    </div>
  </div>

<script>
  // ---- Full indicator list (6 × 5) ----
  const indicators = [
    // 1. Demographics
    {id:'pop_growth_16_22', cat:'Demographics', label:'Population growth (2016–2022)', unit:'%', min:-5, max:15, step:0.1, rha:7.3, nat:8.0},
    {id:'pop_65_plus', cat:'Demographics', label:'Population aged 65+', unit:'%', min:8, max:25, step:0.1, rha:15.0, nat:13.9},
    {id:'pop_75_79_growth', cat:'Demographics', label:'Population aged 75–79 growth', unit:'%', min:0, max:60, step:0.5, rha:40.0, nat:25.0},
    {id:'pop_85_plus_growth', cat:'Demographics', label:'Population aged 85+ growth', unit:'%', min:0, max:50, step:0.5, rha:25.0, nat:20.0},
    {id:'pop_0_4_trend', cat:'Demographics', label:'Population 0–4 years (trend index)', unit:'index', min:-2, max:2, step:1, rha:-1, nat:-1},

    // 2. Economic
    {id:'income_tax_contrib', cat:'Economic', label:'Income tax contribution', unit:'%', min:0, max:12, step:0.1, rha:5.5, nat:8.0},
    {id:'public_health_funding', cat:'Economic', label:'Public health funding', unit:'%', min:0, max:15, step:0.1, rha:7.0, nat:8.0},
    {id:'avg_weekly_income', cat:'Economic', label:'Average weekly income', unit:'€', min:400, max:1500, step:5, rha:590, nat:640},
    {id:'per_capita_investment', cat:'Economic', label:'Per capita investment', unit:'€', min:500, max:2000, step:10, rha:1050, nat:1200},
    {id:'unemployment_15_plus', cat:'Economic', label:'Unemployment aged 15+', unit:'%', min:0, max:20, step:0.1, rha:5.7, nat:5.7},

    // 3. Socioeconomic
    {id:'prof_mgmt_tech', cat:'Socioeconomic', label:'Professional/Managerial/Technical', unit:'%', min:0, max:100, step:0.1, rha:37.9, nat:39.9},
    {id:'third_level_education', cat:'Socioeconomic', label:'Third-level education', unit:'%', min:0, max:100, step:0.1, rha:40.7, nat:42.8},
    {id:'extremely_disadvantaged', cat:'Socioeconomic', label:'Extremely disadvantaged population', unit:'%', min:0, max:10, step:0.1, rha:2.3, nat:1.3},
    {id:'less_affluent_residents', cat:'Socioeconomic', label:'Less affluent residents', unit:'%', min:0, max:100, step:0.1, rha:22.5, nat:24.9},
    {id:'no_internet_access', cat:'Socioeconomic', label:'Households with no Internet access', unit:'%', min:0, max:100, step:0.1, rha:11.0, nat:8.7},

    // 4. Dependency
    {id:'carer_dependency', cat:'Dependency', label:'Carer dependency', unit:'%', min:0, max:100, step:0.1, rha:36.0, nat:34.7},
    {id:'disability', cat:'Dependency', label:'Disability', unit:'%', min:0, max:50, step:0.1, rha:22.2, nat:21.5},
    {id:'age_dependency_rate', cat:'Dependency', label:'Age dependency rate', unit:'%', min:0, max:100, step:0.1, rha:35.9, nat:34.7},
    {id:'avg_home_support', cat:'Dependency', label:'Average home support (weekly)', unit:'minutes', min:0, max:600, step:5, rha:380, nat:397},
    {id:'unpaid_care', cat:'Dependency', label:'People providing unpaid care', unit:'%', min:0, max:20, step:0.1, rha:6.1, nat:5.8},

    // 5. Health System Capacity
    {id:'acute_beds_per_1000', cat:'Health System Capacity', label:'Acute beds per 1,000 population', unit:'/1,000', min:0, max:5, step:0.01, rha:1.76, nat:2.91},
    {id:'ed_consultants_per_100k', cat:'Health System Capacity', label:'ED consultants per 100k', unit:'/100k', min:0, max:10, step:0.01, rha:2.82, nat:3.57},
    {id:'eds_per_100k', cat:'Health System Capacity', label:'Emergency departments per 100k', unit:'/100k', min:0, max:1, step:0.001, rha:(100000/431059), nat:(100000/215527)},
    {id:'gps_per_1000', cat:'Health System Capacity', label:'GPs per 1,000 population', unit:'/1,000', min:0, max:1, step:0.01, rha:0.52, nat:0.65},
    {id:'phi_coverage', cat:'Health System Capacity', label:'Private health insurance coverage', unit:'%', min:0, max:100, step:0.1, rha:53.0, nat:43.0},

    // 6. Healthcare Utilisation
    {id:'medical_card_holders', cat:'Healthcare Utilisation', label:'Medical card holders', unit:'%', min:0, max:100, step:0.1, rha:35.0, nat:34.0},
    {id:'gp_usage', cat:'Healthcare Utilisation', label:'GP usage (visits per person / year)', unit:'visits', min:0, max:10, step:0.1, rha:5.5, nat:4.8},
    {id:'inpatient_nights', cat:'Healthcare Utilisation', label:'Inpatient nights per person / year', unit:'nights', min:0, max:2, step:0.01, rha:0.6, nat:0.78},
    {id:'self_health_good', cat:'Healthcare Utilisation', label:'Self-perceived health (good/very good)', unit:'%', min:0, max:100, step:0.1, rha:81.3, nat:82.9},
    {id:'self_health_bad', cat:'Healthcare Utilisation', label:'Self-perceived health (bad/very bad)', unit:'%', min:0, max:20, step:0.01, rha:1.9, nat:1.7},
  ];

  const categories = [...new Set(indicators.map(d => d.cat))];

  function formatValue(val, unit) {
    const num = Number(val);
    if (unit === '%') return num.toFixed(1) + '%';
    if (unit === '€') return '€' + Math.round(num).toLocaleString();
    if (unit === '/1,000') return num.toFixed(2) + ' /1,000';
    if (unit === '/100k') return num.toFixed(3) + ' /100k';
    if (unit === 'minutes') return Math.round(num) + ' min/wk';
    if (unit === 'visits') return num.toFixed(1) + ' visits';
    if (unit === 'nights') return num.toFixed(2) + ' nights';
    if (unit === 'index') {
      const labels = { "-2":"strong decline","-1":"decline","0":"stable","1":"growth","2":"strong growth" };
      return labels[String(Math.round(num))] ?? String(num);
    }
    return num.toFixed(2) + ' ' + unit;
  }

  // Build the category cards with 5 sub-sliders each
  const grid = document.getElementById('catGrid');
  categories.forEach(cat => {
    const card = document.createElement('div');
    card.className = 'cat-card';

    const title = document.createElement('div');
    title.className = 'cat-title';
    title.textContent = cat;
    card.appendChild(title);

    indicators.filter(d=>d.cat===cat).forEach(ind => {
      const row = document.createElement('div');
      row.className = 'sub-row';

      const lbl = document.createElement('div');
      lbl.className = 'lbl';
      lbl.textContent = ind.label;

      const unit = document.createElement('div');
      unit.className = 'unit';
      unit.textContent = ind.unit;

      const input = document.createElement('input');
      input.type = 'range';
      input.min = ind.min;
      input.max = ind.max;
      input.step = ind.step;
      input.value = ind.rha;     // start at RHA defaults
      input.id = ind.id;

      const val = document.createElement('div');
      val.className = 'val';
      val.id = ind.id + '_val';
      val.textContent = formatValue(ind.rha, ind.unit);

      const ref = document.createElement('div');
      ref.className = 'ref';
      ref.textContent = 'Nat. avg: ' + formatValue(ind.nat, ind.unit);

      input.addEventListener('input', () => {
        val.textContent = formatValue(input.value, ind.unit);
        if (document.getElementById('catSelect').value === ind.cat) redrawChart();
      });

      row.appendChild(lbl);
      row.appendChild(unit);
      row.appendChild(input);
      row.appendChild(val);
      row.appendChild(ref);
      card.appendChild(row);
    });

    grid.appendChild(card);
  });

  // Reset buttons
  document.getElementById('resetRHA').addEventListener('click', () => {
    indicators.forEach(ind => {
      const el = document.getElementById(ind.id);
      const out = document.getElementById(ind.id + '_val');
      if (el) { el.value = ind.rha; out.textContent = formatValue(ind.rha, ind.unit); }
    });
    redrawChart();
  });
  document.getElementById('resetNat').addEventListener('click', () => {
    indicators.forEach(ind => {
      const el = document.getElementById(ind.id);
      const out = document.getElementById(ind.id + '_val');
      if (el) { el.value = ind.nat; out.textContent = formatValue(ind.nat, ind.unit); }
    });
    redrawChart();
  });

  // ----------- Chart.js Horizontal Bar with Scaling Modes -----------
  const catSelect = document.getElementById('catSelect');
  categories.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c; opt.textContent = c;
    catSelect.appendChild(opt);
  });
  catSelect.value = categories[0];
  const scaleSelect = document.getElementById('scaleSelect');
  let chart;

  function getCurrentVal(id) {
    const el = document.getElementById(id);
    return Number(el ? el.value : 0);
  }

  function shorten(label) {
    return label.length > 52 ? label.slice(0, 52) + '…' : label;
  }

  function computeSeries(group, mode) {
    if (mode === 'raw') {
      return {
        labels: group.map(g => shorten(g.label)),
        cur: group.map(g => getCurrentVal(g.id)),
        nat: group.map(g => g.nat),
        xTitle: 'Raw values'
      };
    } else if (mode === 'pctNat') {
      return {
        labels: group.map(g => shorten(g.label)),
        cur: group.map(g => g.nat === 0 ? 0 : (getCurrentVal(g.id) / g.nat) * 100),
        nat: group.map(g => 100),
        xTitle: '% of National average (100 = Nat)'
      };
    } else { // diff
      return {
        labels: group.map(g => shorten(g.label)),
        cur: group.map(g => getCurrentVal(g.id) - g.nat),
        nat: group.map(g => 0),
        xTitle: 'Difference vs National (RHA − Nat)'
      };
    }
  }

  function redrawChart() {
    const cat = catSelect.value;
    const mode = scaleSelect.value;
    const group = indicators.filter(d => d.cat === cat);
    const s = computeSeries(group, mode);

    const ctx = document.getElementById('catChart').getContext('2d');
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: s.labels,
        datasets: [
          { label: 'RHA E MW (current)', data: s.cur, borderWidth: 1,
            backgroundColor: 'rgba(30,58,138,0.45)', borderColor: 'rgba(30,58,138,0.9)' },
          { label: (mode==='pctNat' ? '100% = National avg' : 'National baseline'), data: s.nat, borderWidth: 1,
            backgroundColor: 'rgba(13,148,136,0.35)', borderColor: 'rgba(13,148,136,0.9)' }
        ]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'top', labels: { boxWidth: 10, font: { size: 11 } } },
          tooltip: {
            callbacks: {
              label: function(context) {
                const ind = group[context.dataIndex];
                const raw = context.raw;
                if (mode === 'raw') {
                  return `${context.dataset.label}: ${formatValue(raw, ind.unit)}`;
                } else if (mode === 'pctNat') {
                  return `${context.dataset.label}: ${raw.toFixed(1)}% of Nat`;
                } else {
                  return `${context.dataset.label}: ${raw.toFixed(2)} (RHA − Nat)`;
                }
              }
            }
          }
        },
        scales: {
          x: { beginAtZero: true, ticks: { autoSkip: true }, title: { display: true, text: s.xTitle }, grid: { color: '#e5e7eb' } },
          y: { ticks: { autoSkip: false, maxRotation: 0 }, grid: { color: '#f1f5f9' } }
        },
        elements: { bar: { borderRadius: 3, maxBarThickness: 18, categoryPercentage: 0.8, barPercentage: 0.9 } }
      }
    });
  }

  catSelect.addEventListener('change', redrawChart);
  scaleSelect.addEventListener('change', redrawChart);
  // initial render uses RHA defaults already placed into the sliders
  redrawChart();
</script>
</body>
</html>









